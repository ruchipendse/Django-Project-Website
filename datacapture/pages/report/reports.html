{% extends 'base.html' %}
{% block content_2 %}
    {% if not user.is_authenticated %}
        <script>
            window.location.href = "/";
        </script>
    {% endif %}
    
    <h1>Electral Control Systems</h1>
    <h2>Reports:</h2>

    <div class = "reports"> 
        <form name = "reportsForm" action = "reports" method = "POST">
            {% csrf_token %} 
            <input type = "hidden" id = "selectedCriteria" name = "selectedCriteria" value = "USER"/>
            <div id = 'date_div' align = 'left'>
                <table>
                    <tr>
                        <!-- TODO: if from_date is required field uncomment this  -->
                        <!-- <td><label id="label_from_date" for = "from_date" disabled>From</label></td>
                        <td><input type = "date" name = "from_date" id = "from_date"></td> -->
                        <td><label id="label_to_date" for = "to_date" disabled>To</label></td>
                        <td><input type = "date" name = "to_date" id = "to_date" value = '{{selected_date}}''></td>
                        <td><label id="label_criteria" for = "criteria" disabled>Criteria</label></td>
                        <td>
                            <select id = "report_criteria" name = "report_criteria"  style="min-width:100%;">
                                <option value = "USER">User</option>
                                <option value = "MACHINE">Machine</option>
                                <!-- <option VALUE = PART"">Part</option> -->
                            </select>
                        </td>
                        <td>
                            <input type="submit" id = "generateReport" class="w3-button w3-blue" value=" Generate Report"
                                    onclick = "setFunctionMode('GENERATE')">
                        </td>
                    </tr>
                </table>
            </div>
            <table id = "report_table"  width = 95% border = 1>
                <tr>
                    <th  width="20%">User</th>
                {% for day in report_dates %}
                    <th  >{{day}}</th>

                {% endfor %}
                </tr>
                {% for key, value in userwise_report_data.items %}
                <tr>
                    <td id = "user_column_highlight" class = "user_column_highlight">{{key}}</td>
                    {% for key1, value1 in value.items %}
                    TODO: THESE KEYS USE FOR DRILL DOWN APPROACH
                    -------------------------------------------
                    <td onclick="alert('{{key1}} - {{key}}')">
                        <table border = "1" width = "100%">
                            <tr>
                                <td id = "td_parts_expected" class = "td_parts_expected"  width="50%" align = "right">{{value1.total_parts_finished_expected}}</td>
                                <td id = "td_parts_actual" class = "td_parts_actual"  width="50%" align = "right">{{value1.total_parts_finished_actual}}</td>
                            </tr>
                            <tr>
                                <td id = "td_time_prod" class = "td_time_prod"  width="50%" align = "right">{{value1.total_time_prod_mins}}</td>
                                <td id = "td_time_nonprod" class = "td_time_nonprod"  width="50%" align = "right">{{value1.total_time_nonprod_mins}}</td>
                            </tr>
                          </table>                        
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </table>
        </form>
    </div>

<script>

    function setFunctionMode(fMode){
        document.getElementById('functionMode').value =  fMode;
    }

    function setupSelected(st){
        document.getElementById('editSetupButton').classList.remove('disabled');
        document.getElementById('deleteSetupButton').classList.remove('disabled');
        document.forms["setupsForm"]['selectedSetup'].value = st;

        var setupsListJson = document.getElementById('setupsListJsondata').getAttribute("data");
        var setupsList = JSON.parse(setupsListJson);

        document.getElementById('scode').setAttribute('value', setupsList[st]['id_code'])
        document.getElementById('sname').setAttribute('value', setupsList[st]['name'])
        document.getElementById('sdesc').setAttribute('value', setupsList[st]['desc'])
    }

    /**
        THIS METHOD INITAITES THE STATUS OF REQUIRED FIELDS ON USERS PAGE 
    */
    function init(){
        var userwise_report_dataJSON = document.getElementById('userwise_report_dataJSONdata').getAttribute("data");
        var userwise_report_data = JSON.parse(userwise_report_dataJSON);
        console.log(userwise_report_data);
    }

    init();
</script>
{% endblock %}
